FORM DIALOGS ANALYSIS - KEY PATTERNS

1. DIALOG STATE MANAGEMENT
   - useState(false) for isOpen
   - useState(null) for editingArticle
   - useTransition() for async submit
   - Prevent closing during submit: !isSubmitting

2. CREATE vs EDIT MODE
   - const isEditMode = !!article
   - Different titles, descriptions
   - Different default values
   - Same schema validation
   - Different server actions (createArticle vs updateArticle)

3. VALIDATION SCHEMA (Zod)
   - title: min 5, max 500 chars
   - slug: min 5, max 200, regex for URL-safe
   - excerpt: max 500, optional
   - content: min 50, max 50000
   - coverImage: URL format, optional
   - status: enum ['draft', 'published', 'archived']

4. FORM SETUP (react-hook-form)
   - resolver: zodResolver(schema)
   - mode: 'onChange' for real-time validation
   - defaultValues: initialData or empty object
   - form.watch() for watching specific fields
   - form.setValue() for programmatic updates

5. AUTO-SLUG GENERATION
   - watch('title') for title changes
   - Only in create mode (!isEditMode)
   - generateSlug function:
     * toLowerCase()
     * normalize('NFD') - decompose accents
     * replace /[\u0300-\u036f]/g - remove accents
     * replace /[^a-z0-9]+/g, '-' - non-alphanumeric to dash
     * replace /^-+|-+$/g - trim dashes
     * substring(0, 200) - limit length

6. SERVER ACTION PATTERN
   - 'use server' directive
   - Check authentication (getUser)
   - Check authorization (role check)
   - Parse FormData
   - Validate with Zod
   - Insert/update in database
   - revalidatePath() for cache
   - Return { success: true } or { error: string }

7. AUTO-SAVE HOOK (localStorage)
   - useRef for debounce timer
   - form.watch() calls debouncedSave
   - clearTimeout + setTimeout for debounce
   - localStorage.setItem(key, JSON.stringify(data))
   - localStorage.getItem(key) for restore
   - localStorage.removeItem(key) to clear
   - Only in create mode (not edit)
   - Debounce: 30 seconds default

8. SUBMIT HANDLER
   - startTransition(async () => {...})
   - Convert form data to FormData object
   - Call server action (create or update)
   - Check result.error
   - Show toast(success) or toast(error)
   - onOpenChange(false) to close dialog
   - router.refresh() to revalidate
   - clearStorage() to clean draft

9. FIELD-SPECIFIC PATTERNS
   - Input: basic text fields
   - Textarea: multi-line text
   - Select: status enum field
   - RichTextEditor: HTML content
   - ImageUpload: file upload to storage
   - All disabled={isSubmitting}
   - All have FormDescription for help text
   - All have FormMessage for errors

10. UX CONSIDERATIONS
    - Prevent close during submit
    - Show loading state with spinner
    - Toast notifications for success/error
    - Reset form after successful submit
    - Auto-restore draft from localStorage
    - Real-time validation feedback
    - Clear field errors on typing
    - max-h-[90vh] overflow-y-auto for long forms
    - Aria attributes for accessibility

EXISTING PATTERNS IN CODEBASE:
- UsersClient: Dialog + row actions (edit role)
- AnnouncementsClient: Dialog + form with create/update
- TenantSettingsForm: Multiple cards with separate submit buttons
- ProposalForm: Full form page (not dialog)
- ConfirmDialog: Simple confirmation (not form)

DIFFERENCES FOR ARTICLES:
- Need RichTextEditor (new)
- Need ImageUpload component
- Need auto-slug generation
- Need auto-save to localStorage
- Publish status important (draft/published/archived)
